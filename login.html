<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CBT Login</title>
    <style>
      body {
        font-family: Arial;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #f5f5f5;
      }
      .login-box {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        width: 350px;
        text-align: center;
      }
      input {
        width: 90%;
        padding: 8px;
        margin: 10px 0;
        border-radius: 4px;
        border: 1px solid #ccc;
      }
      button {
        width: 95%;
        padding: 10px;
        background: #1565c0;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
      }
      button:hover {
        background: #0d47a1;
      }
      p {
        color: red;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="login-box">
      <h2>CBT Login</h2>
      <input id="loginId" placeholder="Login ID / Email" /><br />
      <input type="password" id="password" placeholder="Password" /><br />
      <button onclick="login()">Login</button>
      <p id="msg"></p>
    </div>

    <script type="module">
      import { db, auth } from "./firebase.js";
      import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
      import {
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

      window.login = async function () {
        const loginId = document.getElementById("loginId").value.trim();
        const password = document.getElementById("password").value.trim();
        const msg = document.getElementById("msg");
        msg.innerText = "";

        if (!loginId || !password) {
          msg.innerText = "Enter Login ID & Password!";
          return;
        }

        // Admin Login
        const adminEmails = ["placement@satya.com", "placement@ravi.com"];
        if (adminEmails.includes(loginId)) {
          try {
            await signInWithEmailAndPassword(auth, loginId, password);
            const snap = await getDoc(doc(db, "users", loginId));
            if (!snap.exists()) {
              msg.innerText = "Admin not found";
              return;
            }
            const data = snap.data();
            if (data.role !== "admin") {
              msg.innerText = "Access Denied";
              return;
            }
            localStorage.setItem("adminName", data.name || "Admin");
            localStorage.setItem("adminEmail", loginId);
            window.location.href = "dashboard.html";
            return;
          } catch (e) {
            msg.innerText = "Admin Login Failed";
            console.error(e);
            return;
          }
        }

        // Student login
        try {
          const snap = await getDoc(doc(db, "users", loginId));
          if (!snap.exists()) {
            msg.innerText = "Invalid Login ID";
            return;
          }
          const data = snap.data();
          if (data.password !== password) {
            msg.innerText = "Wrong Password";
            return;
          }
          localStorage.setItem("studentName", data.name);
          localStorage.setItem("roll", data.roll);
          localStorage.setItem("loginId", loginId);
          window.location.href = "satya.html";
        } catch (e) {
          msg.innerText = "Login Failed";
          console.error(e);
        }
      };
    </script>
  </body>
</html>
